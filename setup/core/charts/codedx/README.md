
# Code Dx

Run the guided-setup.ps1 PowerShell Core script (in the root directory of this repository) to determine the correct setup.ps1 parameters for your Kubernetes cluster. The setup.ps1 script uses Helm to install and configure Code Dx on a Kubernetes cluster.

## Deployment Diagram

![Kubernetes Deployment Diagram](res/CodeDxK8s.png)

## Configuration

The following table lists the configurable parameters of the Code Dx chart and their default values.

Any values that require locally cloning the chart will be labeled with _"LFV"_ ("Local File Value") in their description.

| Parameter                               | Description                                                                                                                                                                                        | Default                              |
|-----------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| `codedxTomcatImage`                     | Code Dx Tomcat image full name                                                                                                                                                                     | `codedx/codedx-tomcat:v5.1.0`        |
| `codedxTomcatImagePullPolicy`           | Pull policy for the Code Dx Tomcat image                                                                                                                                                           | `IfNotPresent`                       |
| `codedxTomcatImagePullSecrets`          | Pull secrets for Code Dx Tomcat image                                                                                                                                                              | `[]`                                 |
| `codedxTomcatImagePullSecrets[i].name`  | Name of a secret to use for pulling the Code Dx Tomcat image                                                                                                                                       |                                      |
| `codedxTomcatPort`                      | Port for Code Dx Tomcat service                                                                                                                                                                    | `9090`                               |
| `codedxTlsTomcatPort`                   | Port for Code Dx Tomcat service when HTTPS/TLS is enabled                                                                                                                                          | `9090`                               |
| `codedxJavaOpts`                        | Extra options passed to Tomcat JVM                                                                                                                                                                 | `""`                                 |
| `codedxAdminPassword`                   | Password for Code Dx 'admin' account created at installation (random if empty)                                                                                                                     | `""`                                 |
| `existingSecret`                        | Existing secret, with an admin-password field and a cacerts-password field, as an alternative to using codedxAdminPassword and cacertsFilePwd                                                      |                                      |
| `cacertsFile`                           | _(LFV)_ Path to a custom _cacerts_ file for Code Dx                                                                                                                                                | `""`                                 |
| `cacertsFilePwd`                        | Password for the Java cacerts file                                                                                                                                                                 | `""`                                 |
| `serviceAccount.create`                 | Whether to create a ServiceAccount for Code Dx                                                                                                                                                     | `true`                               |
| `serviceAccount.name`                   | Name of the ServiceAccount for Code Dx                                                                                                                                                             |                                      |
| `podSecurityPolicy.codedx.create`       | Whether to create a PodSecurityPolicy for Code Dx pods                                                                                                                                             | `true`                               |
| `podSecurityPolicy.codedx.name`         | Name of the PodSecurityPolicy for Code Dx pods                                                                                                                                                     |                                      |
| `podSecurityPolicy.codedx.bind`         | Whether to bind the PodSecurityPolicy to Code Dx's ServiceAccount                                                                                                                                  | `true`                               |
| `podSecurityPolicy.mariadb.create`      | Whether to create a PodSecurityPolicy for MariaDB pods                                                                                                                                             | `true`                               |
| `podSecurityPolicy.mariadb.name`        | Name of the PodSecurityPolicy for MariaDB pods                                                                                                                                                     |                                      |
| `podSecurityPolicy.mariadb.bind`        | Whether to bind the PodSecurityPolicy to MariaDB's ServiceAccount                                                                                                                                  | `true`                               |
| `networkPolicy.codedx.create`           | Whether to create a NetworkPolicy for Code Dx                                                                                                                                                      | `true`                               |
| `networkPolicy.codedx.ldap`             | Whether to include a rule for allowing LDAP egress (port 389)                                                                                                                                      | `false`                              |
| `networkPolicy.codedx.ldaps`            | Whether to include a rule for allowing LDAPS egress (ports 636, 3269)                                                                                                                              | `false`                              |
| `networkPolicy.codedx.http`             | Whether to include a rule for allowing HTTP egress (port 80)                                                                                                                                       | `false`                              |
| `networkPolicy.codedx.https`            | Whether to include a rule for allowing HTTPS egress (port 443)                                                                                                                                     | `false`                              |
| `networkPolicy.codedx.dependencyCheck`  | Convenience property - if `true`, is the same as setting `http` and `https` values to `true` to allow Dependency-Check database updates                                                            | `true`                               |
| `networkPolicy.codedx.toolService`      | Whether to include a rule for allowing HTTP/S egress and ingress for communicating with a Tool Service (port 3333)                                                                                 | `false`                              |
| `networkPolicy.codedx.toolServiceSelectors`| [Selectors for the network policy allowing egress to a tool service](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#networkpolicypeer-v1beta1-extensions)                 | `false`                              |
| `networkPolicy.codedx.ingressSelectors` | [Additional Ingress selectors for the Code Dx NetworkPolicy against `codedxTomcatPort`](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#networkpolicypeer-v1beta1-extensions) | `[]`                                 |
| `networkPolicy.mariadb.master.create`   | Whether to create a NetworkPolicy for the MariaDB Master                                                                                                                                           | `true`                               |
| `networkPolicy.mariadb.slave.create`    | Whether to create a NetworkPolicy for the MariaDB Slave                                                                                                                                            | `true`                               |
| `persistence.storageClass`              | Explicit storage class for Code Dx's appdata volume claim                                                                                                                                          | `""`                                 |
| `persistence.accessMode`                | Access mode for Code Dx's appdata volume claim                                                                                                                                                     | `ReadWriteOnce`                      |
| `persistence.size`                      | Size of Code Dx's appdata volume claim                                                                                                                                                             | `32Gi`                               |
| `persistence.existingClaim`             | The name of an existing volume claim to use for Code Dx's appdata                                                                                                                                  |                                      |
| `ingress.enabled`                       | Whether to create an Ingress resource for Code Dx                                                                                                                                                  | `false`                              |
| `ingress.annotations`                   | Additional annotations for a generated Code Dx Ingress resource                                                                                                                                    | NGINX proxy read-timeout + body-size |
| `ingress.assumeNginxIngressController`  | Whether to include an NGINX-specific TLS annotation when `codedxTls` is configured                                                                                                                 | `true`                               |
| `ingress.hosts`                         | The list of Code Dx hosts to generate Ingress resources for                                                                                                                                        | `[sample]`                           |
| `ingress.hosts[i].name`                 | The FQDN of a Code Dx host                                                                                                                                                                         |                                      |
| `ingress.hosts[i].tls`                  | Whether to add HTTPS/TLS properties to the generated Ingress resource                                                                                                                              |                                      |
| `ingress.hosts[i].tlsSecret`            | The name of the TLS secret containing corresponding key and cert                                                                                                                                   |                                      |
| `ingress.secrets`                       | List of secrets to generate for use in TLS                                                                                                                                                         | `[]`                                 |
| `ingress.secrets[i].name`               | Name of the secret to be created                                                                                                                                                                   |                                      |
| `ingress.secrets[i].key`                | Base64-encoded encryption key                                                                                                                                                                      |                                      |
| `ingress.secrets[i].keyFile`            | _(LFV)_ Path to encryption key file (ignored if `key` is specified)                                                                                                                                |                                      |
| `ingress.secrets[i].certificate`        | Base64-encoded encryption certificate                                                                                                                                                              |                                      |
| `ingress.secrets[i].certificateFile`    | _(LFV)_ Path to encryption certificate file (ignored if `certificate` is specified)                                                                                                                |                                      |
| `service.type`                          | Service type for Code Dx                                                                                                                                                                           | When unspecified, see Ingress config |
| `service.annotations`                   | Annotations for the Code Dx service                                                                                                                                                                |                                      |
| `codedxProps.file`                      | _(LFV)_ Location of a Code Dx `props` file for configuration                                                                                                                                       | `codedx.props`                       |
| `codedxProps.configMap`                 | Name of the ConfigMap that will store the Code Dx `props` file                                                                                                                                     |                                      |
| `codedxProps.annotations`               | Extra annotations attached to a generated codedx `props` ConfigMap                                                                                                                                 | `{}`                                 |
| `codedxProps.extra`                     | List of extra secrets containing Code Dx props to be loaded                                                                                                                                        | `[]`                                 |
| `codedxProps.extra[i].secretName`       | Name of the secret to be loaded and mounted                                                                                                                                                        |                                      |
| `codedxProps.extra[i].key`              | Name of the key within the secret that contains Code Dx props text                                                                                                                                 |                                      |
| `licenseSecret`                         | Name of the secret that will store the Code Dx license                                                                                                                                             |                                      |
| `loggingConfigFile`                     | _(LFV)_ Location of a `logback.xml` file to customize Code Dx logging                                                                                                                              |                                      |
| `hostBasePath`                          | base path from which the ACS endpoint is derived                                                                                                                                                   |                                      |
| `saml.enabled`                          | whether to configure a SAML identity provider                                                                                                                                                      | false                                |
| `saml.appName`                          | application name previously registered with your SAML IdP                                                                                                                                          |                                      |
| `saml.samlIdpXmlFile`                   | _(LFV)_ Name of the XML file containing SAML IdP information                                                                                                                                       |                                      |
| `extraMounts`                           | List of additional mounts to use                                                                                                                                                                   | `[]`                                 |
| `resources`                             | Defines [resource requests and limits](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/) for Code Dx                                                          |                                      |
| `codedxTls.enabled`                     | Whether to enable HTTPS access                                                                                                                                                                     | `false`                              |
| `mariadb.enabled`                       | Whether to install the MariaDB Helm chart                                                                                                                                                          | `true`                               |
| `mariadb.rootUser.password`             | Password for the MariaDB root user                                                                                                                                                                 | `5jqJL2b8hqn3`                       |
| `mariadb.replication.password`          | Password for the MariaDB replication server                                                                                                                                                        | `11uAQKLgv4JM`                       |
| `mariadb.serviceAccount.create`         | Whether to create a ServiceAccount for MariaDB                                                                                                                                                     | `true`                               |
| `mariadb.serviceAccount.name`           | Name of the ServiceAccount used by MariaDB                                                                                                                                                         |                                      |
| `mariadb.master.persistence.size`       | Persistent volume size for the MariaDB master database                                                                                                                                             | `32Gi`                               |
| `mariadb.slave.persistence.size`        | Persistent volume size for the MariaDB slave (replication) database                                                                                                                                | `32Gi`                               |
| `mariadb.*`                             | [Extra MariaDB props found in its own chart](https://github.com/helm/charts/blob/master/stable/mariadb/README.md#configuration)                                                                    |                                      |
